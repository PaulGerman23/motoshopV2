{% extends 'base.html' %}

{% block title %}Notas de Crédito - MotoShop{% endblock %}

{% block content %}
<div class="page-header mb-4">
    <h1 class="page-title">Notas de Crédito</h1>
    <p class="page-subtitle">Gestión de notas de crédito por devoluciones</p>
</div>

<!-- Filtros -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <select name="estado" class="form-select">
                    <option value="">Todos los estados</option>
                    <option value="emitida" {% if estado_actual == 'emitida' %}selected{% endif %}>Emitidas</option>
                    <option value="aplicada" {% if estado_actual == 'aplicada' %}selected{% endif %}>Aplicadas Parcialmente</option>
                    <option value="utilizada" {% if estado_actual == 'utilizada' %}selected{% endif %}>Utilizadas Completamente</option>
                    <option value="vencida" {% if estado_actual == 'vencida' %}selected{% endif %}>Vencidas</option>
                    <option value="cancelada" {% if estado_actual == 'cancelada' %}selected{% endif %}>Canceladas</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary-modern btn-modern w-100">
                    <i class="bi bi-search"></i> Filtrar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Notas de Crédito -->
<div class="row g-4">
    {% for nota in notas %}
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">{{ nota.codigo_nota }}</h5>
                    <span class="badge" style="background: rgba(255,255,255,0.2); font-size: 13px;">
                        {{ nota.get_estado_display }}
                    </span>
                </div>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <small class="text-muted">Monto Original</small>
                        <h4 class="mb-0">${{ nota.monto }}</h4>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted">Saldo Disponible</small>
                        <h4 class="mb-0 text-success">${{ nota.saldo_disponible }}</h4>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted">Fecha Emisión</small>
                        <p class="mb-0">{{ nota.fecha_emision|date:"d/m/Y" }}</p>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted">Vence</small>
                        <p class="mb-0">{{ nota.fecha_vencimiento|date:"d/m/Y" }}</p>
                    </div>
                    <div class="col-12">
                        <small class="text-muted">Devolución Origen</small>
                        <p class="mb-0">
                            <a href="{% url 'detalle_devolucion' nota.devolucion.id %}">
                                {{ nota.devolucion.codigo_devolucion }}
                            </a>
                        </p>
                    </div>
                </div>

                <div class="d-flex gap-2 mt-3">
                    <a href="{% url 'detalle_nota_credito' nota.id %}" class="btn btn-primary-modern btn-modern flex-fill">
                        <i class="bi bi-eye"></i> Ver Detalle
                    </a>
                    {% if nota.esta_vigente %}
                    <button class="btn btn-modern" style="background: #10b981; color: white;" data-bs-toggle="modal" data-bs-target="#modalAplicar{{ nota.id }}">
                        <i class="bi bi-check-circle"></i> Aplicar
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center py-5">
                <div class="empty-state">
                    <i class="bi bi-receipt-cutoff"></i>
                    <p>No hay notas de crédito registradas</p>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}